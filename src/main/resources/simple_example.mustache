-- *-cr
insert into odpp.events
select
case 
when da.productClass in ('Deposit', 'Interbank deposit') then 'IA_DEP-cr'
else 'IA_LOA-cr' 
end                as eventTrigger
,da.dealID
,t.transactionid   as eventObject
,t.amount
,t.bdate
,t.branch
from odpp.transactions t
join odpp.deal_asset_acc_tmp da on da.bdate = t.bdate and da.branch = t.branch
  and da.accid = t.creditid 
  and da.productClass in ('Loan', 'Interbank loan', 'Deposit', 'Interbank deposit')
  and da.accountingclass in ('Interest accrued', 'Interest prepayment')
where t.bdate = DATE'${bdate}' and t.branch = '${branch}'
  and (
     t.debitno like '70601________11%' -- PL_interest income
  or t.debitno like '70606________31%' -- PL_Interest expenses
  )
;
-- *-db
insert into odpp.events
select
case 
when da.productClass in ('Deposit', 'Interbank deposit') then 'IA_DEP-db'
else 'IA_LOA-db'  
end                as eventTrigger
,da.dealID
,t.transactionid   as eventObject
,t.amount
,t.bdate
,t.branch
from odpp.transactions t
join odpp.deal_asset_acc_tmp da on da.bdate = t.bdate and da.branch = t.branch
  and da.accid = t.debitid 
  and da.productClass in ('Loan', 'Interbank loan', 'Deposit', 'Interbank deposit')
  and da.accountingclass in ('Interest accrued', 'Interest prepayment')
where t.bdate = DATE'${bdate}' and t.branch = '${branch}'
  and (
     t.creditno like '70601________11%' -- PL_interest income
  or t.creditno like '70606________31%' -- PL_Interest expenses
  )
;

-- Cession-cr
insert into odpp.events
select
'IA_LCS-cr'        as eventTrigger
,da.dealID
,t.transactionid   as eventObject
,t.amount
,t.bdate
,t.branch
from odpp.transactions t
join odpp.deal_asset_acc_tmp da on da.bdate = t.bdate and da.branch = t.branch
  and da.accid = t.creditid 
  and da.productClass = 'Loan_Cession'
  and da.accountingclass in ('Interest accrued', 'Interest prepayment', 'Principal')
where t.bdate = DATE'${bdate}' and t.branch = '${branch}'
  and (
     t.debitno like '70601________11%' -- PL_interest income
  or t.debitno like '70606________31%' -- PL_Interest expenses
  or t.debitno like '70606________34%' -- PL_Premium (assets)
  )
;

-- Cession-db
insert into odpp.events
select
'IA_LCS-db'        as eventTrigger
,da.dealID
,t.transactionid   as eventObject
,t.amount
,t.bdate
,t.branch
from odpp.transactions t
join odpp.deal_asset_acc_tmp da on da.bdate = t.bdate and da.branch = t.branch
  and da.accid = t.debitid 
  and da.productClass = 'Loan_Cession'
  and da.accountingclass in ('Interest accrued', 'Interest prepayment', 'Principal')
where t.bdate = DATE'${bdate}' and t.branch = '${branch}'
  and (
     t.creditno like '70601________11%' -- PL_interest income
  or t.creditno like '70606________31%' -- PL_Interest expenses
  or t.creditno like '70606________34%' -- PL_Premium (assets)
  )
;
