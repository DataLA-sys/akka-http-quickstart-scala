insert overwrite table odpp_acc.inclient_t partition(bdate='${bdate}', branch='${branch}')
select c.key
      ,case when c.sourceid = 'ABS' then c.sourcesubjectid else c.sourcesubjectid||'_'||c.sourceid end as ClientID
      ,if(c.isnaturalperson = 0, 1, 0) as IsCommerical
      ,c.shortname as PartyReference
from odpp.subject_tmp c
where 1 = 1
  and c.bdate = '${bdate}'
  and c.branch = '${branch}'
  and exists (
    select 1 from odpp_acc.incontract_t cc
    where 1 = 1
      and cc.bdate = c.bdate
      and cc.branch = c.branch
      and cc.clientid = case when c.sourceid = 'ABS' then c.sourcesubjectid else c.sourcesubjectid||'_'||c.sourceid end
  )
;
