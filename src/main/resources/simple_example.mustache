-- CommissionRecognition
insert into odpp.events
select 
'CommRecognition' as eventTrigger
,da1.dealID 
,t.transactionid   as eventObject
,t.amount
,t.bdate
,t.branch
from odpp.transactions t 
join odpp.deal_asset_acc_tmp da1 on da1.bdate = t.bdate and da1.branch = t.branch 
  and da1.accid = t.creditid 
  and da1.productClass in ('Loan', 'Loan_Cession', 'Credit Line', 'Interbank loan')
  and da1.accountingClass in ('CommissionP')    
join odpp_dict.ga_product ga2 on t.bdate between ga2.validfrom and ga2.validto
  and ga2.ga2 = substr(t.debitno,1,5)
  and ga2.accountingClass in ('CommissionA') 
where t.bdate = DATE'${bdate}' and t.branch = '${branch}'
;

-- CostRecognition
insert into odpp.events
select 
'CostRecognition'  as eventTrigger
,da1.dealID 
,t.transactionid   as eventObject
,t.amount
,t.bdate
,t.branch
from odpp.transactions t 
join odpp.deal_asset_acc_tmp da1 on da1.bdate = t.bdate and da1.branch = t.branch 
  and da1.accid = t.debitid 
  and da1.productClass in ('Loan', 'Loan_Cession', 'Credit Line', 'Interbank loan', 'Interbank deposit', 'Deposit')
  and da1.accountingClass in ('CostsA')    
join odpp_dict.ga_product ga2 on t.bdate between ga2.validfrom and ga2.validto
  and ga2.ga2 = substr(t.creditno,1,5) 
  and ga2.accountingClass in ('CostsP') 
where t.bdate = DATE'${bdate}' and t.branch = '${branch}'
;
